buildscript {
  ext {
    springBootVersion = '2.0.0.RC1'
  }
  repositories {
    maven { url "https://plugins.gradle.org/m2/" }
    maven { url "https://repo.spring.io/milestone" }
    maven { url "https://plugins.gradle.org/m2/" }
  }
  dependencies {
    classpath 'com.gradle:build-scan-plugin:1.11'
    classpath "org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}"
    classpath "gradle.plugin.org.cedar:dockerplugin:1.0.2"
  }
}

group = 'org.cedar.psi'

subprojects {
  group = rootProject.group
  version = rootProject.version

  ext {
    spockVersion = '1.1-groovy-2.4'
    springCloudVersion = 'Finchley.M5'
  }

  afterEvaluate {
    repositories {
      mavenCentral()
      maven { url "https://repo.spring.io/milestone" }
    }

    dependencyManagement {
      imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
      }
    }

    configurations {
      compile.exclude module: 'tomcat-annotations-api', group: 'org.apache.tomcat'
    }

    if (project.plugins.hasPlugin('org.cedar.dockerplugin')) {
      docker {
        username = System.getenv('DOCKER_USER')
        password = System.getenv('DOCKER_PASSWORD')
      }
    }
  }
}

